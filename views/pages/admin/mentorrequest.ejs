<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Importing the main-style headers -->
    <% include ../../partials/admin-style %>


</head>
<body>


<!-- Importing the main-style headers -->
<% include ../../partials/admin-sidenav %>

<div class = "container-fluid text-center">
    <div class="row content">
        <div class="col-sm-1"></div>



        <!-- Main COntent of the Page -->
        <div class="col-sm-10 text-left main-content" >
            <div class="searchResults">

            </div>

            <div class="mentorRequest">

            </div>




        </div><!-- ENd of main content of the page-->
        <div class="col-sm-1"></div>


    </div> <!-- End of row content -->
</div> <!-- End of container-fluid -->

<% include ../../partials/adminfooter %>

<script src="javascript/admin/commonview.js"></script>
<script src="javascript/admin/mentorrequestview.js"></script>
<script>
    $(function () {

        var displayRequests=function(){
            $.ajax({
                url:'/mrequests',
                Type:'GET',
                dataType:'json',
                success:function (data) {
                    console.log("result for search: "+JSON.stringify(data));

                    if(data.length){
                        $(".mentorRequest").html(contentFormat(data));
                    }else{
                        $(".searchResults").html("<span class='success'>There is no Mentor Request</span>");
                    }
                    //resetting the result for the previous search
                    $('#tags').val("");

                },
                error:function () {
                    throw error;
                }

            });
        };


       //The following display the users who requested to become a mentor
        var contentFormat = function(data){
            var content="";
            content+="<div class='row'><div class = 'col-sm-5'><div class='row'>";
            for(var i=0; i<data.length; i++){

                content+="<div class='media mentor-box' id='"+data[i]._id+"'>" +
                        "<a class='pull-left' href='#'>" +
                        "<img class='media-object' data-src='holder.js/64x64' alt='64x64' style='width: 60px; height: 60px;' src='"+data[i].profilePicture+"'>" +
                        "</a>" +
                        "<div class='media-body'>" +
                        "<h5 class='media-heading'>"+data[i].givenname+" "+data[i].familyname+"</h5>" +
                        "<a>"+data[i].specialty+"</a>" +
                        "<div class='pull-right'>" +
                        "<a href = '#' class = 'btn btn-success btn-circle' role = 'button' onclick='acceptRequest(this)'>" +
                        "<span class='glyphicon glyphicon-ok'></span>" +
                        "</a>" +
                        "<a href = '#' class = 'btn btn-default btn-circle' role = 'button' onclick='rejectRequest(this)'>" +
                        "<span class='glyphicon glyphicon-remove'></span>" +
                        "</a>" +
                        "</div>" +
                        "</div>" +
                        "</div>";
            }
            content += "</div></div></div>";

            return content;
        };

        //Run the function whenever on this page
        displayRequests();

        //accept mentor request
        window.acceptRequest=function (that) {
            console.log("accept a mentor request");
            var userId=$(that).parent().parent().parent().attr("id");
            console.log(userId);
            $("#"+userId).remove();

            $.ajax({
                url:'/acceptmentor?id='+userId,
                type:'DELETE',
                success:function () {
                    console.log("finished accepting");

                }
            });

        };

        //reject mentor request
        window.rejectRequest=function (that) {
            console.log("reject a mentor request");
            var userId=$(that).parent().parent().parent().attr("id");
            console.log(userId);
            $("#"+userId).remove();

            $.ajax({
                url:'/rejectmentor?id='+userId,
                type:'DELETE',
                success:function () {
                    console.log("Finished rejecting");

                }
            });

        };
    });
</script>

</body>
</html>

